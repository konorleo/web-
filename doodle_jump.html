<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doodle Jump</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
        }
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .menu {
            text-align: center;
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #000;
            background-color: #fff;
        }
        .controls {
            display: none;
            margin-top: 10px;
        }
        .controls button {
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
        }
        .controls button:hover {
            background-color: #45a049;
        }
        @media (max-width: 600px) {
            .controls {
                display: flex;
                justify-content: space-around;
                width: 100%;
            }
            canvas { width: 90%; }
        }
        @media (min-width: 601px) {
            .game-container {
                flex-direction: row;
            }
            .menu {
                margin-right: 20px;
                margin-bottom: 0;
            }
            canvas { margin-left: 20px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="menu">
            <h2>Doodle Jump</h2>
            <button onclick="startGame()">Start</button>
            <button onclick="pauseGame()">Pause</button>
            <button onclick="resetGame()">Reset</button>
            <button onclick="window.location.href='index.html'">Menu</button>
            <p>Score: <span id="score">0</span></p>
        </div>
        <canvas id="doodleCanvas" width="300" height="500"></canvas>
        <div class="controls">
            <button>←</button>
            <button>→</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('doodleCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');

        const PLAYER_WIDTH = 20;
        const PLAYER_HEIGHT = 30;
        const PLATFORM_WIDTH = 60;
        const PLATFORM_HEIGHT = 10;
        const GRAVITY = 0.5;
        let player = { x: canvas.width / 2 - PLAYER_WIDTH / 2, y: canvas.height - 50, dy: 0, dx: 0, speed: 5 };
        let platforms = [{ x: canvas.width / 2 - PLATFORM_WIDTH / 2, y: canvas.height - 20, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT }];
        let score = 0, started = false, paused = false;
        let tiltHistory = [];
        const TILT_SMOOTHING = 5;

        function startGame() {
            if (!started) {
                started = true;
                resetGame();
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(response => {
                            if (response === 'granted') window.addEventListener('deviceorientation', handleOrientation);
                        })
                        .catch(console.error);
                } else {
                    window.addEventListener('deviceorientation', handleOrientation);
                }
                requestAnimationFrame(gameLoop);
            }
        }

        function pauseGame() {
            if (started) paused = !paused;
        }

        function resetGame() {
            score = 0;
            scoreElement.textContent = score;
            player = { x: canvas.width / 2 - PLAYER_WIDTH / 2, y: canvas.height - 50, dy: 0, dx: 0, speed: 5 };
            platforms = [{ x: canvas.width / 2 - PLATFORM_WIDTH / 2, y: canvas.height - 20, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT }];
            spawnPlatforms();
        }

        function spawnPlatforms() {
            while (platforms.length < 6) {
                const last = platforms[platforms.length - 1];
                platforms.push({
                    x: Math.random() * (canvas.width - PLATFORM_WIDTH),
                    y: last.y - (50 + Math.random() * 130), // Max 180px apart
                    w: PLATFORM_WIDTH,
                    h: PLATFORM_HEIGHT
                });
            }
        }

        function update() {
            player.dy += GRAVITY;
            player.y += player.dy;
            player.x += player.dx;

            if (player.x < 0) player.x = canvas.width - PLAYER_WIDTH;
            if (player.x + PLAYER_WIDTH > canvas.width) player.x = 0;

            if (player.y < canvas.height / 3) {
                const offset = canvas.height / 3 - player.y;
                player.y = canvas.height / 3;
                platforms.forEach(p => p.y += offset);
                score += offset;
                scoreElement.textContent = Math.floor(score / 100);
                platforms = platforms.filter(p => p.y < canvas.height);
                spawnPlatforms();
            }

            platforms.forEach(p => {
                if (player.dy > 0 && player.x + PLAYER_WIDTH > p.x && player.x < p.x + p.w &&
                    player.y + PLAYER_HEIGHT > p.y && player.y + PLAYER_HEIGHT <= p.y + p.h + player.dy) {
                    player.dy = -15; // Longer jump
                }
            });

            if (player.y > canvas.height) {
                alert("Game Over!");
                resetGame();
            }
            player.dx *= 0.9; // Smooth deceleration
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'green';
            platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));
            ctx.fillStyle = 'blue';
            ctx.fillRect(player.x, player.y, PLAYER_WIDTH, PLAYER_HEIGHT);
        }

        function gameLoop() {
            if (!started || paused) return requestAnimationFrame(gameLoop);
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function handleOrientation(event) {
            if (!started || paused) return;
            const gamma = event.gamma;
            tiltHistory.push(gamma);
            if (tiltHistory.length > TILT_SMOOTHING) tiltHistory.shift();
            const averageGamma = tiltHistory.reduce((a, b) => a + b, 0) / tiltHistory.length;
            player.dx = averageGamma * 0.1; // Smoother tilt
        }

        const leftButton = document.querySelector('.controls button:nth-child(1)');
        const rightButton = document.querySelector('.controls button:nth-child(2)');

        leftButton.addEventListener('touchstart', startMovingLeft);
        leftButton.addEventListener('touchend', stopMoving);
        rightButton.addEventListener('touchstart', startMovingRight);
        rightButton.addEventListener('touchend', stopMoving);

        leftButton.addEventListener('mousedown', startMovingLeft);
        leftButton.addEventListener('mouseup', stopMoving);
        rightButton.addEventListener('mousedown', startMovingRight);
        rightButton.addEventListener('mouseup', stopMoving);

        function startMovingLeft() { if (started && !paused) player.dx = -player.speed; }
        function startMovingRight() { if (started && !paused) player.dx = player.speed; }
        function stopMoving() { player.dx = 0; }

        document.addEventListener('keydown', e => {
            if (!started || paused) return;
            switch (e.key) {
                case 'ArrowLeft': player.dx = -player.speed; break;
                case 'ArrowRight': player.dx = player.speed; break;
            }
        });

        document.addEventListener('keyup', e => {
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') player.dx = 0;
        });
    </script>
</body>
</html>
</body>
</html>
