<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doodle Jump</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        canvas {
            border: 1px solid #000;
            background-color: #fff;
        }
        .game-menu {
            text-align: center;
            margin-right: 20px;
        }
        .game-menu h2 {
            margin-bottom: 10px;
            font-size: 20px;
        }
        .game-menu button, .controls button {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
        }
        .game-menu button:hover, .controls button:hover {
            background-color: #45a049;
        }
        .controls {
            display: none;
            margin-top: 10px;
        }
        @media (max-width: 600px) {
            .container {
                flex-direction: column;
            }
            .game-menu {
                margin-right: 0;
                margin-bottom: 20px;
            }
            canvas {
                width: 90%;
                height: auto;
            }
            .controls {
                display: flex;
                justify-content: space-between;
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-menu">
            <h2>Doodle Jump</h2>
            <button onclick="startGame()">Начать игру</button>
            <button onclick="pauseGame()">Пауза</button>
            <button onclick="resetGame()">Перезапустить</button>
            <button onclick="window.location.href='index.html'">Выбрать другую игру</button>
            <p>Счёт: <span id="score">0</span></p>
            <div class="controls">
                <button onclick="moveLeft()">←</button>
                <button onclick="moveRight()">→</button>
            </div>
        </div>
        <canvas id="doodleCanvas" width="300" height="500"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('doodleCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');

        const PLAYER_WIDTH = 20;
        const PLAYER_HEIGHT = 30;
        const PLATFORM_WIDTH = 60;
        const PLATFORM_HEIGHT = 10;
        const GRAVITY = 0.5;
        let player = { x: canvas.width / 2 - PLAYER_WIDTH / 2, y: canvas.height - 50, dy: 0, dx: 0, speed: 5 };
        let platforms = [{ x: canvas.width / 2 - PLATFORM_WIDTH / 2, y: canvas.height - 20, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT }];
        let score = 0, started = false, paused = false;

        function startGame() {
            if (!started) {
                started = true;
                resetGame();
                // Запрос разрешения на ориентацию (для iOS)
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(response => {
                            if (response === 'granted') {
                                window.addEventListener('deviceorientation', handleOrientation);
                            }
                        })
                        .catch(console.error);
                } else {
                    window.addEventListener('deviceorientation', handleOrientation);
                }
                requestAnimationFrame(gameLoop);
            }
        }

        function pauseGame() {
            if (started) paused = !paused;
        }

        function resetGame() {
            score = 0;
            scoreElement.textContent = score;
            player = { x: canvas.width / 2 - PLAYER_WIDTH / 2, y: canvas.height - 50, dy: 0, dx: 0, speed: 5 };
            platforms = [{ x: canvas.width / 2 - PLATFORM_WIDTH / 2, y: canvas.height - 20, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT }];
            spawnPlatforms();
        }

        function spawnPlatforms() {
            while (platforms.length < 6) {
                const last = platforms[platforms.length - 1];
                platforms.push({
                    x: Math.random() * (canvas.width - PLATFORM_WIDTH),
                    y: last.y - (50 + Math.random() * 100),
                    w: PLATFORM_WIDTH,
                    h: PLATFORM_HEIGHT
                });
            }
        }

        function update() {
            player.dy += GRAVITY;
            player.y += player.dy;
            player.x += player.dx;

            if (player.x < 0) player.x = canvas.width - PLAYER_WIDTH;
            if (player.x + PLAYER_WIDTH > canvas.width) player.x = 0;

            if (player.y < canvas.height / 3) {
                const offset = canvas.height / 3 - player.y;
                player.y = canvas.height / 3;
                platforms.forEach(p => p.y += offset);
                score += offset;
                scoreElement.textContent = Math.floor(score / 100);
                platforms = platforms.filter(p => p.y < canvas.height);
                spawnPlatforms();
            }

            platforms.forEach(p => {
                if (player.dy > 0 && player.x + PLAYER_WIDTH > p.x && player.x < p.x + p.w &&
                    player.y + PLAYER_HEIGHT > p.y && player.y + PLAYER_HEIGHT <= p.y + p.h + player.dy) {
                    player.dy = -10;
                }
            });

            if (player.y > canvas.height) {
                alert("Игра окончена!");
                resetGame();
            }
            player.dx *= 0.9; // Плавное затухание движения
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'green';
            platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));
            ctx.fillStyle = 'blue';
            ctx.fillRect(player.x, player.y, PLAYER_WIDTH, PLAYER_HEIGHT);
        }

        function gameLoop() {
            if (!started || paused) return requestAnimationFrame(gameLoop);
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Управление для ПК (клавиатура)
        document.addEventListener('keydown', e => {
            if (!started || paused) return;
            switch (e.key) {
                case 'ArrowLeft': player.dx = -player.speed; break;
                case 'ArrowRight': player.dx = player.speed; break;
            }
        });

        // Управление для телефона (сенсорные кнопки + наклон)
        function moveLeft() { if (started && !paused) player.dx = -player.speed; }
        function moveRight() { if (started && !paused) player.dx = player.speed; }

        function handleOrientation(event) {
            if (!started || paused) return;
            const gamma = event.gamma; // Наклон влево/вправо (-90 до 90 градусов)
            player.dx = gamma * 0.3; // Чувствительность наклона
        }
    </script>
</body>
</html>
